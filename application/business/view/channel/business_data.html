{extend name="common/base" /}
{block name="title"}游戏盈亏结算{/block}
{block name="css"}
<style type="text/css">
    .layui-table-highlight {
        /*background-color:#1E90FF;*/
        color: #e60000;font-weight: bold;
    }

    .layui-table-highlight:hover {
        background-color: #7ebd90 !important;
    }
    .layui-anim{
    	max-height: 500px !important;
    }
    .layui-form-label{
    	width: auto !important;
    }
    .layui-col-md3{
    	width: 20%;
    }
</style>
{/block}
{block name="content"}
<div class="layui-row layui-col-space20">
	<div class="layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                <span class="layui-badge layui-bg-blue ">{:lang('新增人数')}</span>
                <a class="layui-icon layui-icon-refresh-3 layuiadmin-badge"></a>
            </div>
            <div class="layui-card-body layuiadmin-card-list">
                <p class="layuiadmin-big-font" id="PersonCount" style="color: #009688">0</p>
            </div>
        </div>
    </div>
    <div class="layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                <span class="layui-badge layui-bg-blue ">{:lang('首充人数')}</span>
                <a class="layui-icon layui-icon-refresh-3 layuiadmin-badge"></a>
            </div>
            <div class="layui-card-body layuiadmin-card-list">
                <p class="layuiadmin-big-font" id="FirstRechargeCount" style="color: #009688">0</p>
            </div>
        </div>
    </div>
    <div class="layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                <span class="layui-badge layui-bg-blue ">{:lang('总充值')}</span>
                <a class="layui-icon layui-icon-refresh-3 layuiadmin-badge"></a>
            </div>
            <div class="layui-card-body layuiadmin-card-list">
                <p class="layuiadmin-big-font" id="TotalRecharge" style="color: #009688">0</p>
            </div>
        </div>
    </div>
    <div class="layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                <span class="layui-badge layui-bg-blue ">{:lang('总提现')}</span>
                <a class="layui-icon layui-icon-refresh-3 layuiadmin-badge"></a>
            </div>
            <div class="layui-card-body layuiadmin-card-list">
                <p class="layuiadmin-big-font" id="TotalDrawMoney" style="color: #009688">0</p>
            </div>
        </div>
    </div>
    <div class="layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                <span class="layui-badge layui-bg-blue ">{:lang('充值营收')}</span>
                <a class="layui-icon layui-icon-refresh-3 layuiadmin-badge"></a>
            </div>
            <div class="layui-card-body layuiadmin-card-list">
                <p class="layuiadmin-big-font" id="Profit" style="color: #009688">0</p>
            </div>
        </div>
    </div>
</div>
<div class="layui-card" style="margin-top: 10px">
	
    <div class="layui-card-header layuiadmin-card-header-auto">
        <form class="layui-form" lay-filter="component-form-group">

            <div class="layui-form-item">
            	{if(session('business_Proxytype') == 1)}
                <div class="layui-inline">
                    <label class="layui-form-label">{:lang('业务员ID')}</label>
                    <div class="layui-input-inline">
                        <input type="text" name="roleid" autocomplete="off" class="layui-input" id='roleid'>
                    </div>
                </div>
                {/if}
                <!-- <div class="layui-inline">
                    <label class="layui-form-label">{:lang('业务员级别')}</label>
                    <div class="layui-input-inline">
                        <select name="bustype" id="bustype" class="layui-input">
                                <option value="">{:lang('全部')}</option>
                                <option value="1">{:lang('业务组长')}</option>
                                <option value="2">{:lang('普通业务员')}</option>
                          </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">{:lang('上级业务员ID')}</label>
                    <div class="layui-input-inline">
                        <input type="text" name="parentName" autocomplete="off" class="layui-input" id='parentName'>
                    </div>
                </div> -->
                <div class="layui-inline">
                    <label class="layui-form-label">{:lang('日期')}</label>
                    <div class="layui-input-inline">
                        <input type="text" name="start" id="LAY-component-form-group-date" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid"> -
                    </div>
                    <div class="layui-input-inline">
                        <input type="text" name="end" id="LAY-component-form-group-date2" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <input type="hidden" name="tab" id="searchtab" value="total">
                <div class="layui-inline">
                    <!-- <div class="layui-input-inline"> -->
                        <a class="layui-btn" id="search">{:lang('搜索')}</a>
                        <!-- <a class="layui-btn layui-btn-danger" id="total">{:lang('全部')}</a> -->
                        <!-- <a class="layui-btn" id="today">{:lang('今日')}</a>
                        <a class="layui-btn" id="yestoday">{:lang('昨日')}</a>
                        <a class="layui-btn" id="week">{:lang('本周')}</a>
                        <a class="layui-btn" id="lastweek">{:lang('上周')}</a>
                        <a class="layui-btn" id="month">{:lang('本月')}</a>
                        <a class="layui-btn" id="lastmonth">{:lang('上个月')}</a> -->
                        
                    <!-- </div> -->
                </div>
            </div>
        </form>

    </div>
    <div style="padding-top: 10px;padding-left: 15px">
		<div class="layui-inline">
            <a class="layui-btn layui-btn-danger" id="total">{:lang('全部')}</a>
            <a class="layui-btn" id="today">{:lang('今日')}</a>
            <a class="layui-btn" id="yestoday">{:lang('昨日')}</a>
            <a class="layui-btn" id="week">{:lang('本周')}</a>
            <a class="layui-btn" id="lastweek">{:lang('上周')}</a>
            <a class="layui-btn" id="month">{:lang('本月')}</a>
            <a class="layui-btn" id="lastmonth">{:lang('上个月')}</a>
    	</div>
    </div>
    <div class="layui-card-body">
        <div id="alllist">
            <table id="proxylist" lay-filter="proxylist"></table>
        </div>
    </div>
</div>

{/block}
{block name="script"}

<script id="msg-bar" type="text/html">
    <input type="button" class="layui-btn layui-btn-xs" lay-event="roomInfo" value="{:lang('查看明细')}">
</script>
<script>

	url = "{:url('channel/businessData')}";
	layui.config({
		base: '__layui__/' //静态资源所在路径
	}).extend({
		index: 'lib/index' //主入口模块
	}).use(['index', 'table', 'layer', 'element', 'laydate', 'form', 'jquery'], function () {
		var element = layui.element, layer = layui.layer, laydate = layui.laydate, table = layui.table, $ = layui.$, form = layui.form;
		var main = {
			renderData: function () {
				var cols = [ //表头
					{field: 'Date', align: 'center', title: "{:lang('日期')}", minWidth: 100},
					{field: 'ChannelId', align: 'center', title: "{:lang('业务员ID')}", minWidth: 100},
					{field: 'AccountName', align: 'center', title: "{:lang('业务员名称')}", minWidth: 100},
					{field: 'parentName', title: "{:lang('组长名称')}", minWidth: 100,  align: 'center'},
					{field: '', align: 'center', title: "{:lang('新增/活跃用户')}", minWidth: 100, templet: function(d){
                    	return d.PersonCount+" / "+d.ActiveUserCount;
                	}},
					{field: 'FirstRechargeCount', align: 'center', title: "{:lang('首充人数')}", minWidth: 100},
					{field: '', align: 'center', title: "{:lang('总充值/充值人数')}", minWidth: 100, templet: function(d){
                    	return d.TotalRecharge+" / "+d.RechargeCount;
                	}},
					{field: '', align: 'center', title: "{:lang('总提现/提现人数')}", minWidth: 100, templet: function(d){
                    	return d.TotalDrawMoney+" / "+d.TotalDrawCount;
                	}},
                	{field: 'Profit', align: 'center', title: "{:lang('充值营收')}", minWidth: 100, templet: function(d){
                        if (d.Profit > 0 ) {
                            return '<span style="color:red">'+d.Profit+'</span>'
                        } else {
                            return '<span style="color:green">'+d.Profit+'</span>'
                        }
                        
                    }},
				];
				table.render({
					elem: '#proxylist', url: url,where:{
						Action:'list'
                    } , page: true /*开启分页*/, limit: 15, cols: [cols], sort: true,
					autoSort: false,
					done: function (res, curr, count) {
						data = res.other;
						$('#PersonCount').html(data.PersonCount);
						$('#FirstRechargeCount').html(data.FirstRechargeCount);
						$('#TotalRecharge').html(data.TotalRecharge);
						$('#TotalDrawMoney').html(data.TotalDrawMoney);
						$('#Profit').html(data.Profit);
					}
				});
			},

			//搜索
			search: function () {

				//执行重载
				table.reload('proxylist', {
					page: {curr: 1},
					where: {
						roleid: $.trim($('#roleid').val()),
						tab: $.trim($('#searchtab').val()),
						start: $.trim($('#LAY-component-form-group-date').val()),
						end: $.trim($('#LAY-component-form-group-date2').val()),
						bustype:$('#bustype').val(),
                  		parentName:$('#parentName').val(),
					}
				});
			},
			init: function () {
				main.renderData();
				laydate.render({
					elem: '#LAY-component-form-group-date'
					, format: 'yyyy-MM-dd'
					, max: 1
					, lang:'{$datelang ?: "cn"}'
					, btns: ['clear', 'confirm']
					// , value: new Date()
				});
				laydate.render({
					elem: '#LAY-component-form-group-date2'
					, format: 'yyyy-MM-dd'
					, max: 1
					, lang:'{$datelang ?: "cn"}'
					, btns: ['clear', 'confirm']
					// , value: new Date()
				});
				$('#search').on('click', function (e) {
					$('#searchtab').val('');
					$('.layui-btn-danger').removeClass('layui-btn-danger');
					$('#search').addClass('layui-btn-danger');
					e.preventDefault();
					main.search();
				});
			}
		};
		main.init();
		$('#total').click(function () {
			$('#searchtab').val('total');
			$('.layui-btn-danger').removeClass('layui-btn-danger');
			$('#total').addClass('layui-btn-danger');
			main.search();
		});
		$('#today').click(function () {
			$('#searchtab').val('today');
			$('.layui-btn-danger').removeClass('layui-btn-danger');
			$('#today').addClass('layui-btn-danger');
			main.search();
		});
		$('#yestoday').click(function () {
			$('#searchtab').val('yestoday');
			$('.layui-btn-danger').removeClass('layui-btn-danger');
			$('#yestoday').addClass('layui-btn-danger');
			main.search();
		});
		$('#month').click(function () {
			$('#searchtab').val('month');
			$('.layui-btn-danger').removeClass('layui-btn-danger');
			$('#month').addClass('layui-btn-danger');
			main.search();
		});
		$('#lastmonth').click(function () {
			$('#searchtab').val('lastmonth');
			$('.layui-btn-danger').removeClass('layui-btn-danger');
			$('#lastmonth').addClass('layui-btn-danger');
			main.search();
		});
		$('#week').click(function () {
			$('#searchtab').val('week');
			$('.layui-btn-danger').removeClass('layui-btn-danger');
			$('#week').addClass('layui-btn-danger');
			main.search();
		});
		$('#lastweek').click(function () {
			$('#searchtab').val('lastweek');
			$('.layui-btn-danger').removeClass('layui-btn-danger');
			$('#lastweek').addClass('layui-btn-danger');
			main.search();
		});
	});
	$('#output').click(function () {
		
	});
</script>
{/block}